---
import Layout from "../layouts/Layout.astro";
import { getCollection } from "astro:content";

const BASE = import.meta.env.BASE_URL; // ★追加
const now = new Date();

const all = await getCollection("dialogues");
const items = all
  .filter((e) => e.data.publishAt <= now)
  .sort((a, b) => b.data.publishAt.getTime() - a.data.publishAt.getTime());
---

<Layout showStars={true} starPattern="home" bodyClass="page-dialogues">
  <section class="container page fade-in-section">
    <h1 class="glitch-text">DIALOGUES //</h1>
    <p class="lead">
      思想・構造・生存戦略。Gitに積まれ、時間で公開される対話ログ。
    </p>

    <div class="dialogues-list">
      {items.length === 0 ? (
        <div class="empty">
          <p>まだ公開されている対話ログはありません。</p>
        </div>
      ) : (
        items.map((entry) => (
          <a class="dialogue-card" href={`/dialogues/${entry.slug}/`}>
            <div class="meta">
              <time datetime={entry.data.publishAt.toISOString()}>
                {entry.data.publishAt.toLocaleString("ja-JP")}
              </time>
            </div>
            <h2 class="title">{entry.data.title}</h2>
            {entry.data.description && <p class="desc">{entry.data.description}</p>}
          </a>
        ))
      )}
    </div>
  </section>
</Layout>
